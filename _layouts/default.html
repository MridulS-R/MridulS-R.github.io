<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta id="meta-theme-color" name="theme-color" content="#121417">
    <link rel="icon" href="{{ '/assets/favicon.svg' | relative_url }}" type="image/svg+xml">
    <script>
      try {
        var t = localStorage.getItem('theme');
        if (t === 'light' || t === 'dark') { document.documentElement.setAttribute('data-theme', t); }
      } catch(e) {}
    </script>
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}" />
    {%- seo -%}
  </head>
  <body>
    <a class="skip-link" href="#content">Skip to content</a>
    <header class="site-header">
      <div class="container header-row">
        <a class="brand" href="{{ '/' | absolute_url }}">{{ site.title }}</a>
        <div>
          <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme" aria-pressed="false">üåô</button>
          <button class="nav-toggle" aria-controls="site-nav" aria-expanded="false" aria-label="Toggle navigation">‚ò∞</button>
        </div>
        <nav class="nav" id="site-nav">
          <a class="{% if page.url == '/' %}active{% endif %}" href="{{ '/' | relative_url }}">Home</a>
          <a class="{% if page.url contains '/projects/' %}active{% endif %}" href="{{ '/projects/' | relative_url }}">Projects</a>
          <a class="{% if page.url contains '/blog/' or page.layout == 'post' %}active{% endif %}" href="{{ '/blog/' | relative_url }}">Blog</a>
          <a class="{% if page.url contains '/tags/' %}active{% endif %}" href="{{ '/tags/' | relative_url }}">Tags</a>
          <a class="{% if page.url == '/feed.xml' %}active{% endif %}" href="/feed.xml">RSS</a>
        </nav>
      </div>
    </header>
    <main id="content" class="container">
      {{ content }}
    </main>
    <footer class="site-footer">
      <div class="container">
        <p>
          ¬© <span id="year"></span> {{ site.author.name | default: 'Author' }} ¬∑
          <a href="https://github.com/{{ site.author.github }}" rel="me">GitHub</a>
          ¬∑ <a href="{{ site.author.linkedin }}" rel="me">LinkedIn</a>
        </p>
      </div>
    </footer>
    <script>
      document.getElementById('year').textContent = new Date().getFullYear();
      (function(){
        var header = document.querySelector('.site-header');
        var t = document.querySelector('.nav-toggle');
        var n = document.getElementById('site-nav');
        if (header) {
          function onScroll(){
            if (window.scrollY > 8) { header.classList.add('scrolled'); }
            else { header.classList.remove('scrolled'); }
          }
          onScroll();
          window.addEventListener('scroll', onScroll, { passive: true });
        }
        if(!t || !n) return;
        t.addEventListener('click', function(){
          var open = n.classList.toggle('open');
          t.setAttribute('aria-expanded', open ? 'true' : 'false');
          if (header) header.classList.toggle('open', open);
        });
      })();
      (function(){
        var btn = document.getElementById('theme-toggle');
        if (!btn) return;
        var meta = document.getElementById('meta-theme-color');
        function updateMetaTheme() {
          try {
            var bg = getComputedStyle(document.documentElement).getPropertyValue('--bg').trim();
            if (meta && bg) meta.setAttribute('content', bg);
          } catch(e) {}
        }
        function apply(theme){
          document.documentElement.setAttribute('data-theme', theme);
          document.documentElement.style.colorScheme = theme;
          try { localStorage.setItem('theme', theme); } catch(e) {}
          btn.textContent = theme === 'light' ? '‚òÄÔ∏è' : 'üåô';
          btn.setAttribute('aria-pressed', theme === 'dark' ? 'true' : 'false');
          updateMetaTheme();
        }
        btn.addEventListener('click', function(){
          var current = document.documentElement.getAttribute('data-theme');
          var next = current === 'light' ? 'dark' : 'light';
          apply(next);
        });
        // Initialize button state
        var t = document.documentElement.getAttribute('data-theme');
        if (t === 'light' || t === 'dark') { apply(t); }
        else {
          // No explicit theme set; infer from OS preference
          var prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
          apply(prefersLight ? 'light' : 'dark');
        }
        updateMetaTheme();
      })();
      (function(){
        // Reveal-on-scroll animations for elements with .reveal
        var els = document.querySelectorAll('.reveal');
        if (!('IntersectionObserver' in window) || els.length === 0) {
          els.forEach(function(e){ e.classList.add('show'); });
          return;
        }
        var io = new IntersectionObserver(function(entries){
          entries.forEach(function(entry){ if (entry.isIntersecting) { entry.target.classList.add('show'); io.unobserve(entry.target); } });
        }, { rootMargin: '0px 0px -10% 0px', threshold: 0.05 });
        els.forEach(function(e){ io.observe(e); });
      })();
    </script>
  </body>
  </html>
